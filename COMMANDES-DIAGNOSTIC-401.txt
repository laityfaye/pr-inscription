# Commandes de diagnostic pour les erreurs 401

# 1. Vérifier que work-permit-countries est publique
cd /home/deploy/pr-inscription/backend
grep -B 2 -A 2 "work-permit-countries" routes/api.php

# 2. Vérifier la configuration Sanctum
php artisan tinker
# Puis dans tinker :
config('sanctum.stateful')
# Doit contenir preinscription.sbcgroupe.ca

# 3. Vérifier le .env
grep SANCTUM_STATEFUL_DOMAINS .env

# 4. Vérifier CORS
php artisan tinker
config('cors.allowed_origins')

# 5. Tester l'API directement
curl -v https://backend.sbcgroupe.ca/api/work-permit-countries
curl -v -X POST https://backend.sbcgroupe.ca/api/login \
  -H "Content-Type: application/json" \
  -H "Origin: https://preinscription.sbcgroupe.ca" \
  -d '{"email":"test@example.com","password":"test"}'

# 6. Vérifier les logs
tail -100 storage/logs/laravel.log | grep -i "401\|unauthorized\|sanctum"

# 7. Vider le cache
php artisan config:clear
php artisan cache:clear
php artisan route:clear

